<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>[Write-Up] Pragyan CTF - Old school hack</title>
	
	<meta name="author" content="Quentin Meffre">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">
	<link href="/assets/css/syntax.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/meffre-q">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/0xdagger">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:quentin.meffre@epitech.eu">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/?s=35" class="img-circle" />
				quentin meffre
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/media/XAV_1860.JPG" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">quentin meffre</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Computer science student, passionate about Cyber Security.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/meffre-q">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/0xdagger">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:quentin.meffre@epitech.eu">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/quentin-meffre">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>[Write-Up] Pragyan CTF - Old school hack </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   March 
	   4th,
	   
	   2018
	 </span>
	  <div class="article_body">
	  <p><strong>Points:</strong> 200 <strong>Category:</strong> Pwn <strong>Description:</strong>  Chris is trying out to be a police officer and the applications have just been sent into the police academy. He is really eager to find out about his competition. Help it him back the system and view the other applicant’s applications.</p>

<h1 id="surroundings">Surroundings</h1>
<p>This week-end took place the <a href="https://www.pragyan.org/18/home/">Pragyan CTF</a>. This Write-Up is going to show you how to solve the “Old school hack” pwnable challenges. This challenge was interesting because it was a mix between a wargame challenge and a classic exploit.</p>

<p>You can find the binary/exploit <a href="https://github.com/meffre-q/ctf/tree/master/pragyan/pwn">here</a>.</p>

<h1 id="challenge">Challenge</h1>
<p>This challenge is provided with a binary and an pair of IP/port. After a quick test, the binary is running into the given server.</p>

<p>Let first begin by recover many informations of our binary:</p>

<p><img src="/assets/media/pragyan_infos.png" alt="Check_binary" /></p>

<p>We can get the following informations:</p>
<ul>
  <li>The binary is an ELF, compiled for x86_64 architecture,</li>
  <li>It is linked dynamically,</li>
  <li>It is not stripped,</li>
</ul>

<p>The following protections are enabled:</p>
<ul>
  <li>Partial REad onLy RelOcation,</li>
  <li>Stack smash protection (canary),</li>
  <li>No eXec stack.</li>
</ul>

<p>Let’s try to execute it now:</p>

<p><img src="/assets/media/pragyan_first_try.png" alt="First try" /></p>

<p>The binary start by asking a password. Using ltrace command, we can find the password: kaiokenx20</p>

<p>Now let’s taking a look at the assembly code using IDA:</p>

<p><img src="/assets/media/pragyan_first_ida.png" alt="First ida" /></p>

<p>The last image represent the main() function. We can see two important informations:</p>
<ul>
  <li>The service password is well the one we get using ltrace,</li>
  <li>There is a buffer overflow at the call of scanf().</li>
</ul>

<p>We can’t exploit the buffer overflow because the binary has canary and so on we are going to have a stack smash error if we overflow it.</p>

<p>But as you can see on the last image, we can overflow some data which are one the stack using our buffer overflow. Especially we can overwrite the “var_30” of the stack which represent the name of a file which is going to be read later by the binary.</p>

<p>Using this vulnerability, we are able to read every file that we know the name. But before being able to do this, we have several condition to bypass:</p>

<ul>
  <li>Firstly, we don’t know the name of the file which contain our flag.</li>
  <li>Secondly, we are going to see that the data that we overwrite are overwrite later by the binary.</li>
  <li>Thirdly, the filename must has a size equal to 36.</li>
</ul>

<p>But all this condition are easy to bypass! :)</p>

<p>The first one:</p>

<p><img src="/assets/media/pragyan_first_condition.png" alt="First condition" /></p>

<p>As you can see on the last image, the binary display some text on its output which represent different entry of a menu, then ask for a number on its input and then it jump to a piece of code depending of the user input. (Like a switch statement in C language) Every piece of code overwrite the filename we write using our buffer overflow so we must not enter in this function. The switch has a default value, if the user input doesn’t match with a number between the value ‘1’ and ‘7’ the binary jump to next step without overwriting our filename!</p>

<p>So we just have to enter a value which respect this conditon: value &gt;= 8</p>

<p>It’s ok for the first step.</p>

<p>Now the second step is very easy. If we check the assembly code, we can see the following:</p>

<p><img src="/assets/media/pragyan_second_condition.png" alt="Second condition" /></p>

<p>If the user enter 7 for the menu entry, the binary set the filename to “txt.galf” (which is flag.txt in reverse) then display something on the output and finish by a call to exit().</p>

<p>Let’s try to used “flag.txt” as filename.</p>

<p>But before getting the flag, we have a last condition to fulfill:</p>

<p><img src="/assets/media/pragyan_third_condition.png" alt="Third condition" /></p>

<p>The last image represent the beginning of the function which display the content of the filename we overwrite. As you can see, there is a comparaison between the size of our filename. If our filename doesn’t has a size equal to 36 bytes, the binary raise an error.</p>

<p>As our filename “flag.txt” only has a size of 8 bytes, we have a problem….</p>

<p>But we can simply bypass it using the “./” path which represent the current directory on a Linux system.</p>

<p>So our filename is going to look like this: ././././././././././././././flag.txt</p>

<p>Here is the very little “exploit” (aka command) I used to solve this challenge:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
python <span class="nt">-c</span> <span class="s1">'print "kaiokenx20\x00"+"A"*5+"././././././././././././././flag.txt\x00\n"+"123"'</span>|nc 128.199.224.175 13000
</code></pre></div></div>

<p>Now let’s try it:</p>

<p><img src="/assets/media/pragyan_flag.png" alt="Done" /></p>

<p>Done.</p>


	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#write-up-ref">
					write-up <span>(5)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#pwn-ref">
					pwn <span>(10)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=[Write-Up] Pragyan CTF - Old school hack&via=0xdagger"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="//www.gravatar.com/avatar/" class="img-rounded author-image" />
        <h4 class="section-title author-name">Quentin Meffre</h4>
        <p class="author-bio">Computer science student, passionate about Cyber Security.</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/write-up/2018/02/04/write_up_codegate_sharif.html" title="[Write-Up] Codegate 2018 preliminary CTF / SharifCTF 8">&larr; Previous</a></li>
		  
		  
			<li class="next disabled"><a>Next &rarr;</a>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>





		<footer>
			<hr/>
			<p>
				&copy; 2018 Quentin Meffre with <a href="http://jekyllrb.com/">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90952644-1', 'auto');
  ga('send', 'pageview');
</script>

